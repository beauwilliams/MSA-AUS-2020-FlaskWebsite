"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var rxjs_1 = require("rxjs");
var operators_1 = require("rxjs/operators");
function reduce(func, init) {
    if (init === void 0) { init = 0; }
    return function (line) { return new Promise(function (resolve, reject) {
        line.collect(function (res) {
            var total = init;
            rxjs_1.concat.apply(void 0, res.map(function (i) { return rxjs_1.Observable.create(function (observer) {
                var _t = func(total, i);
                var _complete = function (t) { total = t; observer.complete(); };
                if (_t instanceof rxjs_1.Observable)
                    _t.pipe(operators_1.last()).subscribe(_complete);
                else if (_t instanceof Promise)
                    _t.then(_complete);
                else
                    _complete(_t);
            }); })).subscribe(undefined, function (err) { return reject(err); }, function () { return resolve(total); });
        });
    }); };
}
exports.reduce = reduce;
//# sourceMappingURL=reduce.js.map