"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var rxjs_1 = require("rxjs");
var operators_1 = require("rxjs/operators");
var line_1 = require("./line");
//
// TODO: rewrite with groupBy
//
function _partition(src, key) {
    var _subjects = {};
    var obs$ = src.prep().content$.pipe(operators_1.share());
    return line_1.line(rxjs_1.Observable.create(function (observer) {
        obs$.subscribe({
            next: function (v) {
                var _key = key(v).toString();
                if (!(_key in _subjects)) {
                    _subjects[_key] = new rxjs_1.ReplaySubject();
                    observer.next(line_1.line(_subjects[_key]));
                }
                _subjects[_key].next(v);
            },
            error: function (err) {
                observer.error(err);
                Object.values(_subjects).forEach(function (sub) { return sub.error(err); });
            },
            complete: function () {
                observer.complete();
                Object.values(_subjects).forEach(function (sub) { return sub.complete(); });
            }
        });
    }));
}
function partition(srcOrKey, key) {
    if (key)
        return _partition(srcOrKey, key);
    else
        return function (l) { return _partition(l, srcOrKey); };
}
exports.partition = partition;
//# sourceMappingURL=partition.js.map