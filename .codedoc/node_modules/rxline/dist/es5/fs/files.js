"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var rxjs_1 = require("rxjs");
var path_1 = require("path");
var fs_1 = require("fs");
var line_1 = require("../line");
function _files$(path, options, depth) {
    options.recursive = options.recursive !== false;
    var abspath = options.root ? path_1.join(options.root, path) : path;
    return rxjs_1.Observable.create(function (observer) {
        fs_1.lstat(abspath, function (err, stats) {
            if (err)
                observer.error(err);
            else {
                if (stats.isDirectory()) {
                    if (options.recursive || depth === 0) {
                        fs_1.readdir(abspath, function (err, res) {
                            /* istanbul ignore if */
                            if (err)
                                observer.error(err);
                            else
                                rxjs_1.merge.apply(void 0, res.map(function (name) { return _files$(path_1.join(path, name), options, depth + 1); })).subscribe(observer);
                        });
                    }
                    else
                        observer.complete();
                }
                else {
                    observer.next({ path: path, root: options.root || '', content: undefined });
                    observer.complete();
                }
            }
        });
    });
}
function files$(path, options) {
    if (options === void 0) { options = { recursive: true }; }
    return _files$(path, options, 0);
}
exports.files$ = files$;
function files(path, options) {
    if (options === void 0) { options = { recursive: true }; }
    return line_1.line(files$(path, options));
}
exports.files = files;
//# sourceMappingURL=files.js.map