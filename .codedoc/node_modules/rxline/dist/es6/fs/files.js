import { Observable, merge } from 'rxjs';
import { join } from 'path';
import { lstat, readdir } from 'fs';
import { line } from '../line';
function _files$(path, options, depth) {
    options.recursive = options.recursive !== false;
    const abspath = options.root ? join(options.root, path) : path;
    return Observable.create((observer) => {
        lstat(abspath, (err, stats) => {
            if (err)
                observer.error(err);
            else {
                if (stats.isDirectory()) {
                    if (options.recursive || depth === 0) {
                        readdir(abspath, (err, res) => {
                            /* istanbul ignore if */
                            if (err)
                                observer.error(err);
                            else
                                merge(...res.map(name => _files$(join(path, name), options, depth + 1))).subscribe(observer);
                        });
                    }
                    else
                        observer.complete();
                }
                else {
                    observer.next({ path, root: options.root || '', content: undefined });
                    observer.complete();
                }
            }
        });
    });
}
export function files$(path, options = { recursive: true }) {
    return _files$(path, options, 0);
}
export function files(path, options = { recursive: true }) {
    return line(files$(path, options));
}
//# sourceMappingURL=files.js.map