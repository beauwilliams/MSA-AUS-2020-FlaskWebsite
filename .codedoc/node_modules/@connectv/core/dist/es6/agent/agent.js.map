{"version":3,"file":"agent.js","sourceRoot":"","sources":["../../../src/agent/agent.ts"],"names":[],"mappings":"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","sourcesContent":["import { PartialFlow } from '../pin/partial-flow';\n\nimport { group, Group } from '../pin/group';\nimport { PinMap } from '../pin/pin-map';\nimport { PinLike } from '../pin/pin-like';\nimport { Pin } from '../pin/pin';\n\nimport { InputNotInSignature,\n        OutputNotInSignature } from './errors/signature-mismatch.error';\nimport { ImproperPartialFlow } from './errors/improper-partial-flow.error';\nimport { Signature } from './signature';\nimport { AgentLike } from './agent-like';\n\n\n/**\n *\n * The parent class for [agents](https://connective.dev/docs/agent).\n *\n */\nexport class Agent extends PartialFlow implements AgentLike {\n  private _inputs: PinMap;\n  private _outputs: PinMap;\n  private _entries: Group;\n  private _exits: Group;\n\n  /**\n   *\n   * @param signature the [signature](https://connective.dev/docs/agent#signature)\n   * of the agent. Must be determined either by instantiators or sub-classes.\n   *\n   */\n  constructor(readonly signature: Signature) {\n    super();\n    this._inputs = new PinMap(label => this.createInput(label));\n    this._outputs = new PinMap(label => this.createOutput(label));\n  }\n\n  /**\n   *\n   * @param label\n   * @returns the input pin corresponding to given label\n   * @throws an error if given label is not allowed by the agent's\n   * [signature](https://connective.dev/docs/agent#signature).\n   *\n   */\n  public in(label: string | number) { return this._inputs.get(label.toString()); }\n\n  /**\n   *\n   * @param label\n   * @returns the output pin corresponding to given label\n   * @throws an error if given label is not allowed by the agent's\n   * [signature](https://connective.dev/docs/agent#signature).\n   *\n   */\n  public out(label: string | number) { return this._outputs.get(label.toString()); }\n\n  /**\n   *\n   * @returns the entry pins for this agent for it to behave as a partial flow.\n   * You can read more about partial flows [here](https://connective.dev/docs/agent#implicit-connection).\n   *\n   */\n  public get entries(): Group {\n    if (!this._entries) {\n      let entries = this.createEntries();\n      this._entries = (entries instanceof Group)?entries:group(...entries);\n    }\n\n    return this._entries;\n  }\n\n  /**\n   *\n   * @returns the exit pins for this agent for it to behave as a partial flow.\n   * You can read more about partial flows [here](https://connective.dev/docs/agent#implicit-connection).\n   *\n   */\n  public get exits(): Group {\n    if (!this._exits) {\n      let exits = this.createExits();\n      this._exits = (exits instanceof Group)?exits:group(...exits);\n    }\n\n    return this._exits;\n  }\n\n  public get inputs(): PinMap { return this._inputs; }\n  public get outputs(): PinMap { return this._outputs; }\n\n  /**\n   *\n   * @note an Agent's `.clear()` also clears up\n   * input and output pins.\n   *\n   */\n  public clear(): this {\n    this._inputs.clear();\n    this._outputs.clear();\n\n    return super.clear();\n  }\n\n  /**\n   *\n   * Checks if given input label matches the agent's\n   * [signature](https://connective.dev/docs/agent#signature).\n   *\n   * Override this to change how validation of input labels occurs.\n   *\n   * @param label the input label to be validated\n   *\n   */\n  protected checkInput(label: string) {\n    if (!this.signature.inputs || !this.signature.inputs.includes(label))\n      throw new InputNotInSignature(label, this.signature);\n  }\n\n  /**\n   *\n   * Checks if given output label matches the agent's\n   * [signature](https://connective.dev/docs/agent#signature).\n   *\n   * Override this to change how validation of output labels occurs.\n   *\n   */\n  protected checkOutput(label: string) {\n    if (!this.signature.outputs.includes(label))\n      throw new OutputNotInSignature(label, this.signature);\n  }\n\n  /**\n   *\n   * Validates given label and creates the corresponding input pin.\n   *\n   * Override this to change how an input pin is created.\n   *\n   * @param label\n   * @returns the corresponding input pin.\n   *\n   */\n  protected createInput(label: string): PinLike {\n    this.checkInput(label);\n    return new Pin();\n  }\n\n  /**\n   *\n   * Validates given label and creates the corresponding output pin.\n   *\n   * Override this to change how an output pin is created.\n   *\n   * @param label\n   * @returns the corresponding output pin.\n   *\n   */\n  protected createOutput(label: string): PinLike {\n    this.checkOutput(label);\n    return new Pin();\n  }\n\n  /**\n   *\n   * Override this to specify which pins should be considered as entries of this agent as a `PartialFlow`.\n   * You can read more about partial flows [here](https://connective.dev/docs/agent#implicit-connection).\n   * If not overriden, the agent will be considered an improper patial flow and an error will be thrown\n   * when used as one.\n   *\n   */\n  protected createEntries(): PinLike[] | Group {\n    throw new ImproperPartialFlow(this);\n  }\n\n  /**\n   *\n   * Override this to specify which pins should be considered as exits of this agent as a `PartialFlow`.\n   * You can read more about partial flows [here](https://connective.dev/docs/agent#implicit-connection).\n   * If not overriden, the agent will be considered an improper patial flow and an error will be thrown\n   * when used as one.\n   *\n   */\n  protected createExits(): PinLike[] | Group {\n    throw new ImproperPartialFlow(this);\n  }\n}\n"]}