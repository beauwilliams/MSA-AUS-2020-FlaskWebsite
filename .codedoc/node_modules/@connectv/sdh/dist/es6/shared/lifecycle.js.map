{"version":3,"file":"lifecycle.js","sourceRoot":"","sources":["../../../src/shared/lifecycle.ts"],"names":[],"mappings":";;;;;;;;;AAAA,MAAM,UAAU,aAAa,CAAC,IAAU,EAAE,OAAqB;IAC7D,IAAI,IAAI,YAAY,gBAAgB,EAAE;QACpC,IAAI,MAAM,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC;QAC/B,IAAI,CAAC,MAAM;YACT,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,OAAO,CAAC,CAAC;KAC7C;;QAEC,CAAE,IAAY,CAAC,UAAU,GAAI,IAAY,CAAC,UAAU,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC9E,CAAC;AAGD,MAAM,UAAU,QAAQ,CAAC,IAAU;IACjC,IAAI,aAAa,GAAmB,EAAE,CAAC;IACvC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,aAAa,GAAG,aAAa,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAExF,OAAO,CAAE,IAAY,CAAC,UAAU,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;AAChE,CAAC;AAGD,MAAM,UAAgB,OAAO,CAAC,IAAU;;QACtC,MAAM,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;QAClC,OAAO,IAAI,CAAC;IACd,CAAC;CAAA;AASD,MAAM,CAAC,MAAM,yBAAyB,GAAG,CAAC,CAAC;AAC3C,MAAM,CAAC,MAAM,sBAAsB,GAAG,IAAI,CAAC;AAG3C,MAAM,UAAU,YAAY,CAAC,IAAU,EAAE,EAAc,EAAE,QAAQ,GAAG,yBAAyB;IAC3F,IAAI,IAAI,YAAY,gBAAgB,EAAE;QACpC,IAAI,MAAM,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC;QAC/B,IAAI,CAAC,MAAM;YACT,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;KACvC;;QAEC,CAAE,IAAY,CAAC,cAAc,GAAI,IAAY,CAAC,cAAc,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,QAAQ,EAAC,CAAC,CAAC;AAC7F,CAAC;AAGD,MAAM,UAAU,WAAW,CAAC,IAAU;IACpC,CAAE,IAAY,CAAC,cAAc,IAAI,EAAE,CAAC;SACjC,IAAI,CAAC,CAAC,CAAa,EAAE,CAAa,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,GAAG,CAAC,CAAC,QAAQ,CAAC;SAC/D,OAAO,CAAC,CAAC,CAAa,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IACtC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;AACvC,CAAC;AAGD,MAAM,UAAU,WAAW,CAAC,QAA0B,EAAE,MAAY;IACjE,QAAgB,CAAC,WAAW,GAAG,MAAM,CAAC;IACvC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;QAC5B,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;AACjC,CAAC;AAGD,MAAM,UAAU,WAAW,CAAC,QAA0B;IACpD,OAAQ,QAAgB,CAAC,WAAW,CAAC;AACvC,CAAC;AAGD,MAAM,UAAU,WAAW,CAAC,QAA0B;IACpD,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;IAC3C,MAAM,CAAC,YAAY,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;IAClC,WAAW,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;IAE9B,OAAO,MAAM,CAAC;AAChB,CAAC","sourcesContent":["export function attachPromise(host: Node, promise: Promise<any>) {\n  if (host instanceof DocumentFragment) {\n    let marker = getLSMarker(host);\n    if (!marker)\n      attachPromise(addLSMarker(host), promise);\n  }\n  else\n    ((host as any).__promises = (host as any).__promises || []).push(promise);\n}\n\n\nexport function promises(node: Node) {\n  let childPromises = <Promise<any>[]>[];\n  node.childNodes.forEach(child => childPromises = childPromises.concat(promises(child)));\n\n  return ((node as any).__promises || []).concat(childPromises);\n}\n\n\nexport async function isReady(node: Node) {\n  await Promise.all(promises(node));\n  return true;\n}\n\n\ninterface WRCallback {\n  cb: () => void;\n  priority: number;\n}\n\n\nexport const WRCallbackDefaultPriority = 0;\nexport const WRCallbackHighPriority = 1000;\n\n\nexport function whenRendered(node: Node, cb: () => void, priority = WRCallbackDefaultPriority) {\n  if (node instanceof DocumentFragment) {\n    let marker = getLSMarker(node);\n    if (!marker)\n      whenRendered(addLSMarker(node), cb);\n  }\n  else\n    ((node as any).__wr_callbacks = (node as any).__wr_callbacks || []).push({cb, priority});\n}\n\n\nexport function itsRendered(node: Node) {\n  ((node as any).__wr_callbacks || [])\n    .sort((a: WRCallback, b: WRCallback) => b.priority - a.priority)\n    .forEach((w: WRCallback) => w.cb());\n  node.childNodes.forEach(itsRendered);\n}\n\n\nexport function setLSMarker(fragment: DocumentFragment, marker: Node) {\n  (fragment as any).__ls_marker = marker;\n  if (!fragment.contains(marker))\n    fragment.appendChild(marker);\n}\n\n\nexport function getLSMarker(fragment: DocumentFragment) {\n  return (fragment as any).__ls_marker;\n}\n\n\nexport function addLSMarker(fragment: DocumentFragment) {\n  const marker = document.createElement('i');\n  marker.setAttribute('hidden', '');\n  setLSMarker(fragment, marker);\n\n  return marker;\n}\n"]}