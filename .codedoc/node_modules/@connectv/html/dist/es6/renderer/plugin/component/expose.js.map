{"version":3,"file":"expose.js","sourceRoot":"","sources":["../../../../../src/renderer/plugin/component/expose.ts"],"names":[],"mappings":"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","sourcesContent":["import { PropsType } from '../../../shared/types';\n\nimport { PluginPriority, PluginHost } from '../plugin';\nimport { CompProcessPlugin, isCompIOPlugin, isCompPropPlugin, isDefaultReactiveRecipientPlugin } from './basic-plugins';\nimport { CompType, ComponentSignature, ExposeFunction } from './types';\nimport { ComponentInputUnrecognizedError, ComponentOutputUnrecognizedError } from './errors/unhandled-signature-prop.error';\n\n\nexport class ExposePlugin<Renderable=RawValue, Tag=CompType<Renderable | string> | string>\n  implements CompProcessPlugin<Renderable, Tag> {\n\n  prepare(\n    comp: CompType<RawValue | Renderable, Tag>,\n    props: PropsType<Renderable | RawValue>,\n    children: (RawValue | Renderable | Node)[],\n    extras: { [name: string]: any; },\n    pluginHost: PluginHost<RawValue | Renderable, Tag>,\n  ): (node: Node) => void {\n\n    let _signature = <ComponentSignature>{\n      inputs: {},\n      outputs: {},\n      states: {}\n    };\n\n    let expose: ExposeFunction = ((signature: ComponentSignature) => {\n      if (signature.inputs) Object.assign(_signature.inputs, signature.inputs);\n      if (signature.outputs) Object.assign(_signature.outputs, signature.outputs);\n      if (signature.states) Object.assign(_signature.states, signature.states);\n    }) as any;\n\n    let _plugin = pluginHost.plugins.find(isDefaultReactiveRecipientPlugin);\n    let _defaultI = () => _plugin?_plugin.defaultInput():undefined;\n    let _defaultO = () => _plugin?_plugin.defaultOutput():undefined;\n    let _defaultS = () => _plugin?_plugin.defaultState():undefined;\n\n    expose.in = (name: string, i?: any) => { let _ = i || _defaultI(); expose({inputs: {[name]: _}}); return _ }\n    expose.out = (name: string, o?: any) => { let _ = o || _defaultO(); expose({outputs: {[name]: _}}); return _ }\n    expose.state = (name: string, s?: any) => { let _ = s || _defaultS(); expose({states: {[name]: _}}); return _ }\n\n    extras.expose = expose;\n\n    return (node: Node) => {\n      pluginHost.plugins\n        .filter(isCompIOPlugin)\n        .forEach(plugin =>\n          plugin.wire(node, _signature, props, comp, children, pluginHost)\n        );\n\n      let _propPlugins = pluginHost.plugins.filter(isCompPropPlugin);\n      Object.entries(props).forEach(([name, prop]) => {\n        if (!_propPlugins.find(plugin => plugin.wireProp(name, prop, node, _signature, pluginHost))) {\n          if (_signature.inputs && name in _signature.inputs)\n            throw new ComponentInputUnrecognizedError(name, props);\n          else if (_signature.outputs && name in _signature.outputs)\n            throw new ComponentOutputUnrecognizedError(name, props);\n        }\n      });\n    }\n  }\n\n  priority = PluginPriority.High;\n}"]}