{"version":3,"file":"track.js","sourceRoot":"","sources":["../../../../../src/renderer/plugin/component/track.ts"],"names":[],"mappings":"AAEA,OAAO,KAAK,CAAC,MAAM,4BAA4B,CAAC;AAEhD,OAAO,EAAE,cAAc,EAAE,MAAM,WAAW,CAAC;AAK3C,MAAM,OAAO,WAAW;IAAxB;QAsBE,aAAQ,GAAG,cAAc,CAAC,IAAI,CAAC;IACjC,CAAC;IArBC,OAAO,CACL,CAAuC,EACvC,EAAW,EACX,GAAY,EACZ,MAAgC;QAGhC,IAAI,OAAO,GAA6B,EAAE,CAAC;QAC3C,IAAI,MAAwB,CAAC;QAC7B,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,QAA8B,EAAE,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAQ,CAAC;QACnF,MAAM,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,IAAU,EAAE,EAAE,CAAC,MAAM,GAAG,IAAI,CAAC;QAElD,OAAO,CAAC,IAAU,EAAE,EAAE;YACpB,IAAI,IAAI,YAAY,gBAAgB,IAAI,MAAM;gBAC5C,CAAC,CAAC,kBAAkB,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;YAErC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC;QAClD,CAAC,CAAA;IACH,CAAC;CAGF","sourcesContent":["import { Bindable, Clearable } from '@connectv/core';\n\nimport * as L from '../../../shared/life-cycle';\n\nimport { PluginPriority } from '../plugin';\nimport { CompProcessPlugin } from './basic-plugins';\nimport { CompType } from './types';\n\n\nexport class TrackPlugin<Renderable=RawValue, Tag=CompType<Renderable | string> | string>\n  implements CompProcessPlugin<Renderable, Tag> {\n  prepare(\n    _: CompType<Renderable | RawValue, Tag>,\n    __: unknown,\n    ___: unknown,\n    extras: { [name: string]: any; }\n  ): (node: Node) => void {\n\n    let tracked = <(Bindable | Clearable)[]>[];\n    let marker: undefined | Node;\n    extras.track = ((whatever: Bindable | Clearable) => tracked.push(whatever)) as any;\n    extras.track.mark = (node: Node) => marker = node;\n\n    return (node: Node) => {\n      if (node instanceof DocumentFragment && marker)\n        L.setLifeCycleMarker(node, marker);\n\n      tracked.forEach(thing => L.attach(thing, node));\n    }\n  }\n\n  priority = PluginPriority.High;\n}"]}