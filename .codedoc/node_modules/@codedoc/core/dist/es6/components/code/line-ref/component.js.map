{"version":3,"file":"component.js","sourceRoot":"","sources":["../../../../../src/components/code/line-ref/component.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,OAAO,EAAE,eAAe,EAAE,SAAS,EAAE,EAAE,EAAE,MAAM,MAAM,CAAC;AAC/D,OAAO,EAAE,GAAG,EAAE,MAAM,EAAE,YAAY,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,EAAO,MAAM,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAE/G,OAAO,EAAE,EAAE,EAAE,UAAU,EAAE,GAAG,EAAE,MAAM,gBAAgB,CAAC;AAGrD,OAAO,EAAE,WAAW,EAAE,MAAM,SAAS,CAAC;AACtC,OAAO,EAAE,SAAS,EAAE,MAAM,2BAA2B,CAAC;AAGtD,MAAM,UAAU,MAAM,CAEpB,CAAM,EACN,QAAa;IAEb,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;IAChD,MAAM,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,QAAQ,EAAE,IAAI,OAAO,EAA2B,CAAC,CAAC;IACjF,MAAM,OAAO,GAAG,IAAI,eAAe,CAA0B,SAAS,CAAC,CAAC;IAExE,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;IAEpD,MAAM,GAAG,GAAG,GAAG,EAAe,CAAC;IAE/B,MAAM,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAChE,IAAI,KAAK,GAAG,KAAK,CAAC;IAClB,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CACrB,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EACtD,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,KAAK,CAAC,EACpB,QAAQ,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;QACjB,EAAE,CAAC,EAAE,CAAC,qBAAqB,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,CAAC,CAAC;QACzC,EAAE,CAAC,CAAC,IAAI,CAAC,CACV,CACF,CAAC;IAEJ,MAAM,KAAK,GAAG,SAAS,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC,IAAI,CACjD,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,KAAK,CAAC,EACpB,GAAG,CAAC,CAAC,CAAC,EAAE,CAAE,CAAgB,CAAC,OAAO,GAAG,EAAE,CAAC,EACxC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CACrC,CAAC;IAEF,MAAM,KAAK,GAAG,OAAO,CAAC,IAAI,CACxB,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAClB,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,CAAA,EAAE,aAAF,EAAE,uBAAF,EAAE,CAAE,YAAY,CAAC,UAAU,MAAK,EAAE,CAAC,EAC7C,GAAG,CAAC,CAAC,CAAC,EAAE;QACN,IAAI,CAAC,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE;YACrB,MAAM,IAAI,GAAG,SAAS,EAAE,CAAC;YACzB,IAAI,IAAI;gBAAE,OAAO,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;SACrC;QAED,OAAO,CAAC,CAAC;IACX,CAAC,CAAC,CACH,CAAC;IAEF,MAAM,KAAK,GAAG,OAAO,CAAC,IAAI,CACxB,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAClB,GAAG,CAAC,EAAE,CAAC,EAAE;QACP,IAAI,EAAE,aAAF,EAAE,uBAAF,EAAE,CAAE,YAAY,CAAC,eAAe;YAAG,OAAO,EAAE,CAAC,YAAY,CAAC,eAAe,CAAC,IAAI,EAAE,CAAC;aAChF;YACH,MAAM,KAAK,GAAG,CAAA,EAAE,aAAF,EAAE,uBAAF,EAAE,CAAE,YAAY,CAAC,UAAU,MAAK,EAAE,CAAC;YACjD,IAAI,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC;gBAAE,OAAO,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;;gBAChD,OAAO,KAAK,CAAC;SACnB;IACH,CAAC,CAAC,CACH,CAAC;IAEF,OAAO,yBAAK,IAAI,EAAE,GAAG,EACjB,KAAK,EAAE,EAAE,CAAA,GAAG,OAAO,CAAC,MAAM,IAAI,UAAU,CAAC,EAAC,MAAM,EAAE,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,EAAC,CAAC,EAAE,EACpF,KAAK,EAAE,EAAE,CAAA,QAAQ,IAAI,YAAY,KAAK,IAAI,EAC1C,YAAY,EAAE,GAAG,EAAE,CAAC,KAAK,GAAG,IAAI,EAChC,YAAY,EAAE,GAAG,EAAE,GAAG,KAAK,GAAG,KAAK,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,EAC/D,OAAO,EAAE,KAAK,CAAC,EAAE;;YACf,IAAI,GAAG,SAAG,OAAO,CAAC,KAAK,0CAAE,YAAY,CAAC,UAAU,CAAC,CAAC;YAElD,IAAI,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,UAAU,CAAC,MAAM,GAAG;gBAC3B,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBACpB,IAAI,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC;gBACzB,OAAM,IAAI,IAAI,EAAC,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,YAAY,CAAC,aAAa,EAAC;oBAAE,IAAI,GAAG,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,aAAa,KAAI,SAAS,CAAC;gBAE1F,IAAI,IAAI,EAAE;oBACR,MAAM,IAAI,SAAG,IAAI,CAAC,aAAa,0CAAE,aAAa,CAC5C,iCAAiC,GAAG,IAAI,CAAC,CAAC;oBAC5C,IAAI,IAAI,EAAE;wBACP,IAA0B,CAAC,KAAK,EAAE,CAAC;wBACpC,KAAK,CAAC,eAAe,EAAE,CAAC;wBACxB,KAAK,CAAC,cAAc,EAAE,CAAC;qBACxB;iBACF;aACF;YAED,KAAK,GAAG,KAAK,CAAC;YACd,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACxB,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,GAAG,SAAS,CAAC;QAC9B,CAAC;QAEH,0BAAM,KAAK,EAAC,WAAW,gBAAiB;QACxC,uBAAG,IAAI,EAAE,KAAK,EAAE,MAAM,EAAC,QAAQ;;YAAM,KAAK,CAAK,CAC3C,CAAC;AACT,CAAC;AAED,OAAO,EAAE,WAAW,EAAE,MAAM,SAAS,CAAC","sourcesContent":["import { Subject, BehaviorSubject, fromEvent, of } from 'rxjs';\nimport { map, filter, debounceTime, mergeMap, switchMap, delay, tap, sample, startWith } from 'rxjs/operators';\nimport { ThemedComponentThis } from '@connectv/jss-theme';\nimport { rl, toggleList, ref } from '@connectv/html';\n\nimport { CodedocTheme } from '../../../theme';\nimport { RefBoxStyle } from './style';\nimport { getConfig } from '../../../transport/config';\n\n\nexport function RefBox(\n  this: ThemedComponentThis<CodedocTheme>,\n  _: any,\n  renderer: any,\n) {\n  const classes = this.theme.classes(RefBoxStyle);\n  const target$ = this.expose.in('target', new Subject<HTMLElement | undefined>());\n  const latest$ = new BehaviorSubject<HTMLElement | undefined>(undefined);\n\n  target$.pipe(filter(el => !!el)).subscribe(latest$);\n\n  const box = ref<HTMLElement>();\n\n  const active$ = target$.pipe(debounceTime(10), map(el => !!el));\n  let hover = false;\n  const top$ = target$.pipe(\n      switchMap(el => el ? of(el) : of(el).pipe(delay(300))),\n      filter(() => !hover),\n      mergeMap(el => el ?\n        of(el.getBoundingClientRect().top + 18) :\n        of(-1000)\n      )\n    );\n\n  const left$ = fromEvent(document, 'mousemove').pipe(\n    filter(() => !hover),\n    map(e => (e as MouseEvent).clientX + 12),\n    sample(active$.pipe(filter(_ => _))),\n  );\n\n  const link$ = target$.pipe(\n    filter(el => !!el),\n    map(el => el?.getAttribute('data-ref') || ''),\n    map(l => {\n      if (l.startsWith('/')) {\n        const conf = getConfig();\n        if (conf) return conf.namespace + l;\n      }\n\n      return l;\n    })\n  );\n\n  const text$ = target$.pipe(\n    filter(el => !!el),\n    map(el => {\n      if (el?.hasAttribute('data-ref-text')) return el.getAttribute('data-ref-text') || '';\n      else {\n        const _text = el?.getAttribute('data-ref') || '';\n        if (_text.startsWith('tab:')) return _text.substr(4);\n        else return _text;\n      }\n    })\n  );\n\n  return <div _ref={box}\n      class={rl`${classes.refbox} ${toggleList({active: active$.pipe(startWith(false))})}`}\n      style={rl`top: ${top$}px;left: ${left$}px`}\n      onmouseenter={() => hover = true}\n      onmouseleave={() => { hover = false; target$.next(undefined); }}\n      onclick={event => {\n        let ref = latest$.value?.getAttribute('data-ref');\n\n        if (ref?.startsWith('tab:')) {\n          ref = ref.substr(4);\n          let tab$ = latest$.value;\n          while(tab$ && !tab$?.hasAttribute('data-tab-id')) tab$ = tab$?.parentElement || undefined;\n\n          if (tab$) {\n            const btn$ = tab$.parentElement?.querySelector(\n              `.selector>button[data-tab-id=\"${ref}\"]`);\n            if (btn$) {\n              (btn$ as HTMLButtonElement).click();\n              event.stopPropagation();\n              event.preventDefault();\n            }\n          }\n        }\n\n        hover = false;\n        target$.next(undefined);\n        box.$.style.top = '-1000px';\n      }}\n    >\n    <span class=\"icon-font\">touch_app</span>\n    <a href={link$} target=\"_blank\">See {text$}</a>\n  </div>;\n}\n\nexport { RefBoxStyle } from './style';"]}