{"version":3,"file":"selection.js","sourceRoot":"","sources":["../../../../src/components/code/selection.ts"],"names":[],"mappings":"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","sourcesContent":["import { funcTransport, onReady } from '@connectv/sdh/transport';\n\nimport { copyToClipboard } from '../../transport/clipboard';\nimport { copyConfirm } from './copy-confirm';\nimport { smartCopy } from './smart-copy';\n\n\nexport function codeSelection() {\n  onReady(() => {\n    const _exec = () => {\n      document.querySelectorAll('pre>code').forEach(code$ => {\n        code$.querySelectorAll('div').forEach(line$ => {\n          line$.addEventListener('mouseenter', event => {\n            if (event.buttons === 1) {\n              line$.classList.add('selected');\n              line$.setAttribute('data-just-selected', 'true');\n            }\n          });\n    \n          line$.addEventListener('mousedown', event => {\n            if (!event.shiftKey) {\n              code$.childNodes.forEach(child => {\n                if (child !== line$) (child as HTMLElement).classList.remove('selected');\n              });\n            }\n    \n            line$.classList.toggle('selected');\n            if (line$.classList.contains('selected')) line$.setAttribute('data-just-selected', 'true');\n          });\n    \n          line$.addEventListener('click', event => {\n            if (!event.shiftKey) {\n              line$.classList.remove('selected');\n              line$.removeAttribute('data-just-selected');\n              if (!code$.classList.contains('has-selection')) {\n                const copyContent = line$.getAttribute('data-content') || '';\n                if (copyContent.trim().length > 0)\n                  copyToClipboard(copyContent, () => copyConfirm(line$));\n              }\n            }\n          });\n        });\n  \n        code$.addEventListener('mouseup', () => {\n          setTimeout(() => {\n            if (code$.querySelectorAll('.selected').length > 0) {\n              document.querySelectorAll('pre>code').forEach(c$ => {\n                if (c$ === code$) return;\n                c$.classList.remove('has-selection');\n                c$.querySelectorAll('.selected').forEach(l$ => l$.classList.remove('selected'));\n              });\n\n              code$.classList.add('has-selection');\n\n              let start = -1;\n              let end = -1;\n              code$.querySelectorAll('div').forEach((line$, index) => {\n                if (line$.hasAttribute('data-just-selected')) {\n                  if (start === -1) start = end = index;\n                  else end = index;\n                }\n              });\n              code$.querySelectorAll('div').forEach((line$, index) => {\n                if (index >= start && index <= end) {\n                  line$.classList.add('selected');\n                  line$.removeAttribute('data-just-selected');\n                }\n              });\n            }\n            else code$.classList.remove('has-selection');\n          }, 5);\n        });\n\n        code$.addEventListener('mouseleave', () => {\n          let start = -1;\n          let end = -1;\n          code$.querySelectorAll('div').forEach((line$, index) => {\n            if (line$.hasAttribute('data-just-selected')) {\n              if (start === -1) start = end = index;\n              else end = index;\n            }\n          });\n          code$.querySelectorAll('div').forEach((line$, index) => {\n            if (index >= start && index <= end) {\n              line$.classList.add('selected');\n              line$.removeAttribute('data-just-selected');\n            }\n          });\n        });\n  \n        code$.addEventListener('keydown', (ev: any) => {\n          const event = ev as KeyboardEvent;\n          if (event.key === 'c' && (event.metaKey || event.ctrlKey)) {\n            if (code$.classList.contains('has-selection')) {\n              smartCopy(code$ as HTMLElement, true);\n            }\n          }\n        });\n      });\n    }\n\n    _exec(); window.addEventListener('navigation', _exec);\n  });\n}\n\n\nexport const codeSelection$ = /*#__PURE__*/funcTransport(codeSelection);\n"]}